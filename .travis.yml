# This is a common .travis.yml for generating library release zip files for
# CircuitPython library releases using circuitpython-build-tools.
# See https://github.com/adafruit/circuitpython-build-tools for detailed setup
# instructions.

dist: xenial
language: python
python:
  - "3.6"

cache:
  pip: true

env:
  - DEPLOY_PYPI="true"

deploy:
  - provider: releases
    api_key: "$GITHUB_TOKEN"
    file_glob: true
    file: "$TRAVIS_BUILD_DIR/bundles/*"
    skip_cleanup: true
    overwrite: true
    on:
      tags: true

  - provider: pypi
    user: adafruit-travis
    password:
      secure: bcUJefESH9Tfvr57A8uXh1//Cv97BfAEE81OM61dZmr33Sce27yxdVBbq4vugezP/G9xP9zlXyJemC/w3BCHO28/jNTCjJl5HiZKLGypuQa8TVcBp6gyMUf+MRcYpMSaSXqc6DHdjQvwoKYheMeRifk2bOzIRo9EaDMuiE44PpcJLAVuFm1Q3n3T9kAQkfC9ObYwn0HE1xAnfKgIRIyDUutMI+fry+ZhDYgV+Gj4xJbMQrmDhtZBQXBpNbu4ZgE0oSPzU2NWdvgeXH0sH4qGD/H9CDMaA0OSeGTk9NHAi2El7H6qY0IA3eEsJJELx+g2jbtZ0WmpY5ti19WC+vYFDD8gkCN5pBldIlaaIpaIqf5vDIFXGmIGFoCTt03gV/dMKXDRYhvEbTEsZmiikdGYFyfdXeXfEn4odHvSXtnAQ8Xgoo0N6uJI6AOpu7GBrZSvQkO3ThLR/f1brTeYGoulu35i6IZ/7Gp3nvXGT9XTKa8+u1pF7y2kr1QhidTC23PQ+W7rTPQdYklf+yYBAMfcLadbrZiDSMTR18s3uraO3vGH71VpCcu35pb/kKJ33k7Z6A74avjc3hvaAoW/eNpIdu6qezVeU2l6d2JwK4b4U0FtcpqzGSUGP9YGKe0TaM52HtkqanpxJpYTWLHl2cWq9fLSd8O5LY4Nz9+QWe3Jd40=
    on:
      tags: true
      condition: $DEPLOY_PYPI = "true"

install:
  - pip install -r requirements.txt
  - pip install circuitpython-build-tools Sphinx sphinx-rtd-theme
  - pip install --force-reinstall pylint==1.9.2

script:
  - pylint adafruit_mpu6050.py
  - ([[ ! -d "examples" ]] || pylint --disable=missing-docstring,invalid-name,bad-whitespace examples/*.py)
  - circuitpython-build-bundles --filename_prefix adafruit-circuitpython-mpu6050 --library_location .
  - cd docs && sphinx-build -E -W -b html . _build/html && cd ..
